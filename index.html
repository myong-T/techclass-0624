<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëª¨ìŠ¤ë¶€í˜¸ í•™ìŠµ í™œë™</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    .screen { display: none; height: 100vh; width: 100vw; }
    #inputScreen {
      display: flex; justify-content: center; align-items: center;
      background-color: #f0f0f0; flex-direction: column;
    }
    textarea {
      width: 80%; height: 100px; font-size: 1.2em;
      padding: 10px; margin-bottom: 10px;
    }
    #warningMsg {
      color: red; font-weight: bold; display: none; margin-bottom: 10px;
    }
    #activityScreen { flex-direction: row; display: none; }
    #left {
      flex: 1; background-color: black;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; color: white;
      position: relative;
    }
    #circle {
      width: 150px; height: 150px; border-radius: 50%;
      background-color: #333;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      transition: background-color 0.2s, box-shadow 0.2s;
      margin: 20px;
    }
    #right {
      flex: 1; background-color: #f4f4f4; padding: 40px;
    }
    input[type="text"] {
      width: 100%; padding: 10px; font-size: 1.2em;
    }
    button {
      padding: 10px 20px; font-size: 1.1em; margin: 10px;
    }
    #feedback, #timerDisplay, #attemptCount {
      margin-top: 20px; font-size: 1.2em; font-weight: bold;
    }
    #correctAnswer {
      margin-top: 15px;
      font-size: 1.1em;
      color: #444;
    }
    #backBtn {
      position: fixed;
      bottom: 0;
      right: 0;
      margin: 10px;
      padding: 8px 16px;
      font-size: 1em;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <div id="inputScreen" class="screen" style="display: flex;">
    <h1>ğŸ‘¤ í•™ìƒ A: ì˜ì–´ ë¬¸ì¥ ì…ë ¥</h1>
    <textarea id="textInput" placeholder="ì˜ˆ: I love you."></textarea><br>

    <!-- âœ… ì•ˆë‚´ ë¬¸êµ¬ ì¶”ê°€ -->
    <div style="font-size: 0.95em; color: #333; margin-bottom: 10px;">
      ğŸ›ˆ ì˜ì–´ ëª¨ìŠ¤ë¶€í˜¸ëŠ” <strong>ëŒ€ë¬¸ì</strong>ë¡œ ì…ë ¥ ë° ì¶œë ¥ë©ë‹ˆë‹¤.
    </div>

    <div id="warningMsg">âš  ì˜ì–´ ë¬¸ì¥ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
    <button id="nextBtn" onclick="moveToActivity()" disabled>ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ</button>
  </div>

  <div id="activityScreen" class="screen">
    <div id="left">
      <div id="circle"></div>
      <button id="playBtn" onclick="startBlinking()" disabled>ğŸ”Š ì¬ìƒí•˜ê¸°</button>
      <button id="retryBtn" onclick="startBlinking()" disabled>ğŸ” ì¬ìƒ ì¬ì‹œë„</button>
      <button id="stopBtn" onclick="stopBlinking()" disabled>â¹ ì •ì§€</button>
      <button onclick="startTimer()">â± íƒ€ì´ë¨¸ ì‹œì‘</button>
      <div id="timerDisplay">ë‚¨ì€ ì‹œê°„: 200ì´ˆ</div>
    </div>
    <div id="right">
      <h2>ğŸ‘¤ í•™ìƒ B: ë“¤ì€ ë‚´ìš©ì„ ì˜ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”</h2>
      <input type="text" id="guess" placeholder="ì •ë‹µ ì…ë ¥" disabled />
      <button id="checkBtn" onclick="checkAnswer()" disabled>ì •ë‹µ í™•ì¸</button>
      <div id="attemptCount">ì œì¶œ ê°€ëŠ¥ íšŸìˆ˜: 5íšŒ</div>
      <div id="feedback"></div>
      <div id="correctAnswer"></div>
    </div>
  </div>

  <button id="backBtn" onclick="resetToStart()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>

  <script>
    const allowedRegex = /^[A-Za-z0-9 .,!?]*$/;
    const morseCode = {
      A: ".-", B: "-...", C: "-.-.", D: "-..", E: ".",
      F: "..-.", G: "--.", H: "....", I: "..", J: ".---",
      K: "-.-", L: ".-..", M: "--", N: "-.", O: "---",
      P: ".--.", Q: "--.-", R: ".-.", S: "...", T: "-",
      U: "..-", V: "...-", W: ".--", X: "-..-", Y: "-.--",
      Z: "--..", 0: "-----", 1: ".----", 2: "..---", 3: "...--",
      4: "....-", 5: ".....", 6: "-....", 7: "--...", 8: "---..",
      9: "----.", " ": "/", ".": ".-.-.-", ",": "--..--",
      "!": "-.-.--", "?": "..--.."
    };

    let originalText = "";
    let morseMap = [];
    let timer = null;
    let timeLeft = 200;
    let blinking = false;
    let stopBlink = false;
    let attemptsLeft = 5;
    let showFinalAnswer = false;

    document.getElementById("textInput").addEventListener("input", validateInput);

    function validateInput() {
      const input = document.getElementById("textInput").value.trim();
      const isValid = allowedRegex.test(input);
      document.getElementById("nextBtn").disabled = !isValid || input === "";
      document.getElementById("warningMsg").style.display = isValid || input === "" ? "none" : "block";
    }

    function moveToActivity() {
      const input = document.getElementById("textInput").value.trim().toUpperCase();
      if (!input) return;

      originalText = input;
      morseMap = [];
      for (let i = 0; i < originalText.length; i++) {
        const char = originalText[i];
        const morse = morseCode[char] || "";
        const isPunctuation = ",.!?".includes(char);
        const isSpace = char === " ";

        if (isSpace) {
          morseMap.push({ symbol: "/", type: "space" });
        } else {
          [...morse].forEach(symbol => {
            morseMap.push({ symbol, type: isPunctuation ? "punctuation" : "normal" });
          });
          if (i < originalText.length - 1 && originalText[i + 1] !== " ") {
            morseMap.push({ symbol: " ", type: "interCharGap" });
          }
        }
      }

      document.getElementById("inputScreen").style.display = "none";
      document.getElementById("activityScreen").style.display = "flex";
    }

    async function startBlinking() {
      if (blinking) return;
      blinking = true;
      stopBlink = false;

      const circle = document.getElementById("circle");

      for (let { symbol, type } of morseMap) {
        let color = "yellow";
        let duration = 200;

        if (type === "space") {
          color = "limegreen";
          duration = 800;
        } else if (type === "punctuation") {
          color = "skyblue";
          duration = symbol === "." ? 200 : 600;
        } else if (type === "interCharGap") {
          await delay(600);
          continue;
        } else {
          duration = symbol === "." ? 200 : 600;
        }

        if (symbol === "." || symbol === "-" || symbol === "/") {
          await blink(circle, duration, color);
        } else {
          await delay(200);
        }

        if (stopBlink) break;
      }

      blinking = false;
    }

    function blink(circle, duration, color) {
      return new Promise(resolve => {
        circle.style.backgroundColor = color;
        circle.style.boxShadow = `0 0 40px ${color}`;
        setTimeout(() => {
          circle.style.backgroundColor = "#333";
          circle.style.boxShadow = "0 0 20px rgba(0,0,0,0.5)";
          setTimeout(resolve, 200);
        }, duration);
      });
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function stopBlinking() {
      stopBlink = true;
    }

    function startTimer() {
      clearInterval(timer);
      timeLeft = 200;
      updateTimerDisplay();

      document.getElementById("playBtn").disabled = false;
      document.getElementById("retryBtn").disabled = false;
      document.getElementById("stopBtn").disabled = false;
      document.getElementById("guess").disabled = false;
      document.getElementById("checkBtn").disabled = false;

      timer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
          clearInterval(timer);
          document.getElementById("timerDisplay").textContent = "â›” ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!";
          disableInputs();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      document.getElementById("timerDisplay").textContent = `ë‚¨ì€ ì‹œê°„: ${timeLeft}ì´ˆ`;
    }

    function disableInputs() {
      document.getElementById("guess").disabled = true;
      document.getElementById("playBtn").disabled = true;
      document.getElementById("retryBtn").disabled = true;
      document.getElementById("stopBtn").disabled = true;
    }

    function checkAnswer() {
      const feedback = document.getElementById("feedback");
      const correctAnswer = document.getElementById("correctAnswer");
      const guess = document.getElementById("guess").value.trim().toUpperCase();

      if (showFinalAnswer) {
        correctAnswer.textContent = `ì •ë‹µì€: ${originalText}`;
        document.getElementById("checkBtn").disabled = true;
        return;
      }

      if (guess === originalText) {
        feedback.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
        disableInputs();
        document.getElementById("checkBtn").disabled = true;
        clearInterval(timer);
      } else {
        attemptsLeft--;
        document.getElementById("attemptCount").textContent = `ì œì¶œ ê°€ëŠ¥ íšŸìˆ˜: ${attemptsLeft}íšŒ`;
        if (attemptsLeft <= 0) {
          feedback.textContent = "âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ê¸°íšŒê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤. ì •ë‹µ í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.";
          document.getElementById("checkBtn").disabled = false;
          showFinalAnswer = true;
        } else {
          feedback.textContent = "âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.";
        }
      }
    }

    function resetToStart() {
      clearInterval(timer);
      document.getElementById("textInput").value = "";
      document.getElementById("guess").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("correctAnswer").textContent = "";
      document.getElementById("attemptCount").textContent = "ì œì¶œ ê°€ëŠ¥ íšŸìˆ˜: 5íšŒ";
      document.getElementById("checkBtn").disabled = true;
      document.getElementById("guess").disabled = true;
      document.getElementById("playBtn").disabled = true;
      document.getElementById("retryBtn").disabled = true;
      document.getElementById("stopBtn").disabled = true;
      document.getElementById("nextBtn").disabled = true;
      document.getElementById("warningMsg").style.display = "none";
      timeLeft = 200;
      updateTimerDisplay();
      attemptsLeft = 5;
      showFinalAnswer = false;
      document.getElementById("activityScreen").style.display = "none";
      document.getElementById("inputScreen").style.display = "flex";
    }
  </script>
</body>
</html>
